name: Verify conflicts in Wiki

# Trigger this action only if there are changes pushed to the wiki/** directory in a pull request
on:
    pull_request:
        branches: [ "main" ]
        paths:
        - wiki/**

env:
  OWNER: ${{ github.event.repository.owner.name }} # This is the repository owner
  REPOSITORY_NAME: ${{ github.event.repository.name }} # This is the repository name

jobs:
    verify_conflicts_wiki:
        name: Verify conflicts in wiki
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            # 1. Create folder named `tmp_wiki`
            # 2. Initialize Git
            # 3. Pull old Wiki content
            - name: Pull content from wiki
              run: |
                mkdir tmp_wiki
                cd tmp_wiki
                git init
                git pull https://github.com/$OWNER/$REPOSITORY_NAME.wiki.git
            # 4. Try to apply all the changes to the wiki
            - name: Push content to wiki
              run: |
                git diff main:wiki/** ** > wiki_diff
                sed -i "s/a\/wiki/a/" wiki_diff
                sed -i "s/b\/wiki/b/" wiki_diff
                cd tmp_wiki
                git apply ../wiki_diff